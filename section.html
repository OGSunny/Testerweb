<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>სექცია • Zaratic Role Play</title>
    <link rel="icon" href="https://raw.githubusercontent.com/OGSunny/Testerweb/main/lv_0_20251120194047.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#e74c3c;--primary-dark:#c0392b;--glass:rgba(15,20,40,0.92);--border:rgba(231,76,60,0.4);--text:#fff;--text2:rgba(255,255,255,0.85);--shadow:0 8px 32px rgba(0,0,0,0.37);}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Noto Sans Georgian',sans-serif;background:#000;color:var(--text);min-height:100vh;}
        #particles-js{position:fixed;width:100%;height:100%;top:0;left:0;z-index:-1;}
        header{position:fixed;top:0;width:100%;padding:18px 5%;background:var(--glass);backdrop-filter:blur(30px);border-bottom:1px solid var(--border);z-index:1000;display:flex;justify-content:space-between;align-items:center;}
        .logo img{width:55px;height:55px;border-radius:50%;box-shadow:0 0 15px var(--primary);}
        .back-btn{padding:12px 28px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px;transition:0.3s;}
        .back-btn:hover{background:var(--primary-dark);transform:translateY(-3px);}
        .container{max-width:1400px;margin:110px auto 50px;padding:0 20px;display:grid;grid-template-columns:280px 1fr;gap:30px;}
        .sidebar{background:var(--glass);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:24px;position:sticky;top:100px;}
        .sidebar h3{color:var(--primary);margin-bottom:20px;font-size:20px;}
        .sidebar a{display:block;padding:12px;color:var(--text2);text-decoration:none;border-radius:8px;margin-bottom:8px;transition:0.3s;}
        .sidebar a:hover,.sidebar a.active{background:rgba(231,76,60,0.2);color:white;}
        .main{background:var(--glass);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:30px;}
        .section-title{font-size:32px;color:var(--primary);margin-bottom:10px;}
        #postForm{display:none;background:rgba(255,255,255,0.05);padding:25px;border-radius:12px;margin-bottom:30px;border:1px solid var(--border);}
        #postForm.show{display:block;}
        .form-input{width:100%;padding:14px;background:rgba(255,255,255,0.08);border:1px solid var(--border);border-radius:8px;color:white;margin-bottom:15px;font-family:inherit;}
        textarea.form-input{min-height:140px;resize:vertical;}
        .form-actions{display:flex;gap:12px;}
        .btn{padding:12px 28px;border:none;border-radius:8px;cursor:pointer;font-weight:600;transition:0.3s;}
        .btn-primary{background:var(--primary);color:white;}
        .btn-primary:hover{background:var(--primary-dark);}
        .btn-secondary{background:transparent;border:1px solid var(--primary);color:var(--primary);}
        .btn-secondary:hover{background:var(--primary);color:white;}
        .posts-list{display:flex;flex-direction:column;gap:22px;}
        .post{background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:12px;padding:22px;position:relative;transition:0.3s;}
        .post:hover{border-color:var(--primary);}
        .post-header{display:flex;align-items:center;gap:14px;margin-bottom:12px;}
        .avatar{width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--primary),#ff6b57);display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:20px;}
        .author{font-weight:600;font-size:18px;}
        .timestamp{color:var(--text2);font-size:14px;margin-left:auto;}
        .post-title{font-size:24px;margin-bottom:12px;color:var(--primary);}
        .post-content{white-space:pre-line;line-height:1.6;}
        .post-actions{margin-top:15px;display:flex;gap:10px;opacity:0;transition:0.3s;}
        .post:hover .post-actions{opacity:1;}
        .post-actions button{background:transparent;border:none;color:var(--text2);cursor:pointer;font-size:18px;transition:0.3s;}
        .post-actions button:hover{color:var(--primary);}
        .admin-only{color:#e67e22 !important;}
        .loading,.empty{text-align:center;padding:60px 20px;color:var(--text2);font-size:18px;}
        .toast{position:fixed;bottom:30px;right:30px;background:var(--primary);color:white;padding:16px 28px;border-radius:12px;box-shadow:var(--shadow);z-index:10000;opacity:0;transform:translateY(20px);transition:all 0.4s;}
        .toast.show{opacity:1;transform:translateY(0);}
        @media(max-width:992px){.container{grid-template-columns:1fr;}.sidebar{position:static;}}
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <header>
        <a href="forum.html" class="logo"><img src="https://raw.githubusercontent.com/OGSunny/Testerweb/main/lv_0_20251120194047.jpg" alt="Logo"> Zaratic RP</a>
        <a href="forum.html" class="back-btn"><i class="fas fa-arrow-left"></i> უკან</a>
    </header>

    <div class="container">
        <aside class="sidebar">
            <h3>კატეგორიები</h3>
            <a href="section.html?id=rules">წესები</a>
            <a href="section.html?id=news">სიახლეები</a>
            <a href="section.html?id=updates">განახლებები</a>
            <a href="section.html?id=info">ინფორმაცია</a>
            <a href="section.html?id=suggestions">წინადადებები</a>
            <a href="section.html?id=events">ივენთები</a>
            <a href="section.html?id=biographies">ბიოგრაფიები</a>
            <a href="section.html?id=complaints-admin">საჩივარი ადმინზე</a>
            <a href="section.html?id=complaints-player">საჩივარი მოთამაშეზე</a>
            <a href="section.html?id=appeals">აპელაციები</a>
            <a href="section.html?id=vacancies-leaders">ლიდერები</a>
            <a href="section.html?id=vacancies-admin">ადმინ. ვაკანსიები</a>
            <a href="section.html?id=vacancies-partner">პარტნიორები</a>
            <a href="section.html?id=donation-help">დონატის დახმარება</a>
            <a href="section.html?id=tech-help">ტექ. დახმარება</a>
        </aside>

        <main class="main">
            <h1 class="section-title" id="title">სექცია</h1>

            <form id="postForm">
                <input type="text" id="postTitle" class="form-input" placeholder="პოსტის სათაური" required>
                <textarea id="postContent" class="form-input" placeholder="პოსტის შინაარსი..." required></textarea>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">გამოქვეყნება</button>
                    <button type="button" onclick="document.getElementById('postForm').reset();document.getElementById('postForm').classList.remove('editing')" class="btn btn-secondary">გაუქმება</button>
                </div>
            </form>

            <div id="postsList"><div class="loading"><i class="fas fa-spinner fa-spin"></i> იტვირთება...</div></div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        const workerUrl = 'https://data.jemalagegidze.workers.dev';
        const admins = ['Zviadi Gegidze', 'Nika Georgadze'];
        const currentUser = localStorage.getItem('username');
        const isAdmin = admins.includes(currentUser);
        const lockedSections = ['rules', 'news', 'updates'];
        const urlParams = new URLSearchParams(location.search);
        const sectionId = urlParams.get('id');
        if (!currentUser) location.href = 'login.html';

        const titles = {
            rules: 'წესები', news: 'სიახლეები', updates: 'განახლებები',
            info: 'ინფორმაცია', suggestions: 'წინადადებები', events: 'ივენთები',
            biographies: 'პერსონაჟების ბიოგრაფიები', 'complaints-admin': 'საჩივარი ადმინზე',
            'complaints-player': 'საჩივარი მოთამაშეზე', appeals: 'აპელაციები',
            'vacancies-leaders': 'ლიდერების ვაკანსიები', 'vacancies-admin': 'ადმინის ვაკანსიები',
            'vacancies-partner': 'პარტნიორები', 'donation-help': 'დონატის დახმარება', 'tech-help': 'ტექნიკური დახმარება'
        };
        document.getElementById('title').textContent = titles[sectionId] || sectionId;
        document.querySelector(`.sidebar a[href*="id=${sectionId}"]`).classList.add('active');

        const canPost = !lockedSections.includes(sectionId) || isAdmin;
        if (canPost) document.getElementById('postForm').classList.add('show');

        particlesJS('particles-js', {particles:{number:{value:70},color:{value:'#e74c3c'},opacity:{value:0.3,random:true},size:{value:3,random:true},line_linked:{enable:true,distance:150,color:'#e74c3c',opacity:0.15},move:{enable:true,speed:1.5}}});

        document.getElementById('postForm').onsubmit = async e => {
            e.preventDefault();
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            if (!title || !content) return showToast('შეავსეთ ყველა ველი');

            const post = {author: currentUser, title, content, timestamp: Date.now()};
            const res = await fetch(workerUrl, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'create',section:sectionId,post})});
            if (res.ok) {document.getElementById('postForm').reset();loadPosts();showToast('პოსტი გამოქვეყნდა');}
            else showToast('შეცდომა');
        };

        async function loadPosts() {
            try {
                const res = await fetch(`${workerUrl}/posts?section=${sectionId}`);
                let posts = await res.json();
                posts.sort((a,b)=>b.timestamp - a.timestamp);
                const list = document.getElementById('postsList');
                if (posts.length===0) {list.innerHTML='<div class="empty">პოსტები არ მოიძებნა</div>';return;}

                list.innerHTML = posts.map((p,i)=>`
                    <div class="post" style="animation-delay:${i*0.1}s">
                        <div class="post-header">
                            <div class="avatar">${p.author[0].toUpperCase()}</div>
                            <div class="author">${escapeHtml(p.author)}</div>
                            <div class="timestamp">${new Date(p.timestamp).toLocaleString('ka-GE')}</div>
                        </div>
                        <h3 class="post-title">${escapeHtml(p.title)}</h3>
                        <div class="post-content">${escapeHtml(p.content).replace(/\n/g,'<br>')}</div>
                        ${(isAdmin || p.author===currentUser)?`
                        <div class="post-actions">
                            ${p.author===currentUser || isAdmin ? `<button onclick="editPost('${p.timestamp}', '${escapeHtml(p.title)}', '${escapeHtml(p.content)}')"><i class="fas fa-edit"></i></button>` : ''}
                            ${isAdmin ? `<button onclick="deletePost('${p.timestamp}')" class="admin-only"><i class="fas fa-trash"></i></button>` : ''}
                        </div>`:''}
                    </div>
                `).join('');
            } catch {showToast('ჩატვირთვის შეცდომა');}
        }

        async function deletePost(ts) {
            if (!confirm('დარწმუნებული ხარ?')) return;
            const res = await fetch(workerUrl, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'delete',section:sectionId,timestamp:ts,post:{author:currentUser}})});
            if (res.ok) {loadPosts();showToast('პოსტი წაიშალა');}
        }

        function editPost(ts, title, content) {
            document.getElementById('postTitle').value = title;
            document.getElementById('postContent').value = content.replace(/<br>/g,'\n');
            document.getElementById('postForm').classList.add('editing');
            document.getElementById('postForm').onsubmit = async e => {
                e.preventDefault();
                const newTitle = document.getElementById('postTitle').value.trim();
                const newContent = document.getElementById('postContent').value.trim();
                const res = await fetch(workerUrl, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'edit',section:sectionId,timestamp:ts,title tional:newTitle,content:newContent,post:{author:currentUser}})});
                if (res.ok) {loadPosts();document.getElementById('postForm').reset();document.getElementById('postForm').onsubmit = document.getElementById('postForm').onsubmit;showToast('პოსტი განახლდა');}
            };
        }

        function escapeHtml(t){const div=document.createElement('div');div.textContent=t;return div.innerHTML;}
        function showToast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.classList.add('show'),50);setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),500);},3000);}
        loadPosts();setInterval(loadPosts,10000);
    </script>
</body>
</html>
