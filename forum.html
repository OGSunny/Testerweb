<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaratic Role Play - áƒ¤áƒáƒ áƒ£áƒ›áƒ˜</title>
   
    <link rel="icon" href="https://raw.githubusercontent.com/OGSunny/Testerweb/main/zaratic.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --primary:#ff1744;--primary-dark:#c41c3b;--secondary:#8b1a31;
            --dark:#0a0e27;--dark-light:#1a1f3a;--dark-lighter:#2d3561;
            --text:#f0f4ff;--text-muted:#a8adc7;
            --accent-blue:#00d4ff;--accent-purple:#b366ff;--accent-green:#66ff66;
            --glass-bg:rgba(26,31,58,0.4);--shadow-sm:0 4px 6px rgba(0,0,0,0.3);
            --shadow-md:0 10px 25px rgba(0,0,0,0.4);--shadow-lg:0 20px 40px rgba(0,0,0,0.5);
            --glow-red:0 0 20px rgba(255,23,68,0.4)
        }
        html{scroll-behavior:smooth}
        body{
            font-family:'Poppins',sans-serif;
            background:linear-gradient(135deg,var(--dark) 0%,#0f1535 50%,var(--dark-light) 100%);
            color:var(--text);min-height:100vh;overflow-x:hidden;position:relative
        }
        body::before{
            content:'';position:fixed;top:0;left:0;width:100%;height:100%;
            background:radial-gradient(circle at 20% 50%,rgba(255,23,68,0.1) 0%,transparent 50%),
                        radial-gradient(circle at 80% 80%,rgba(179,102,255,0.1) 0%,transparent 50%);
            pointer-events:none;z-index:-1
        }
        .navbar{
            background:var(--glass-bg);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,23,68,0.1);
            padding:1.2rem 0;position:sticky;top:0;z-index:1000;box-shadow:var(--shadow-md)
        }
        .nav-content{max-width:1400px;margin:0 auto;padding:0 1.5rem;display:flex;justify-content:space-between;align-items:center}
        .logo{
            font-size:1.8rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;display:flex;align-items:center;gap:0.8rem;
            letter-spacing:-0.5px
        }
        .logo img{height:45px;border-radius:50%;box-shadow:var(--glow-red);transition:transform 0.3s}
        .logo img:hover{transform:scale(1.1) rotate(5deg)}
        .nav-actions{display:flex;gap:1rem;align-items:center}
        .user-info{
            display:flex;align-items:center;gap:0.8rem;padding:0.6rem 1.2rem;
            background:linear-gradient(135deg,rgba(255,23,68,0.1),rgba(179,102,255,0.1));
            border:1px solid rgba(255,23,68,0.2);border-radius:50px;cursor:pointer;
            transition:all 0.3s;backdrop-filter:blur(10px)
        }
        .user-info:hover{
            transform:scale(1.05);box-shadow:var(--glow-red);
            background:linear-gradient(135deg,rgba(255,23,68,0.2),rgba(179,102,255,0.2))
        }
        .user-avatar{
            width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            background-size:cover;background-position:center;box-shadow:0 0 15px rgba(255,23,68,0.5);
            display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.9rem
        }
        .user-badges{display:flex;gap:0.4rem;flex-wrap:wrap}
        .badge{
            padding:0.35rem 0.75rem;border-radius:25px;font-size:0.7rem;font-weight:700;
            text-transform:uppercase;letter-spacing:0.5px;border:1px solid rgba(255,255,255,0.2);
            transition:all 0.3s;backdrop-filter:blur(10px)
        }
        .badge:hover{transform:scale(1.15);box-shadow:0 0 15px currentColor}
        .btn{
            padding:0.7rem 1.8rem;border:none;border-radius:10px;font-weight:600;cursor:pointer;
            transition:all 0.3s;font-size:0.95rem;position:relative;overflow:hidden;
            backdrop-filter:blur(10px)
        }
        .btn::before{
            content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);
            transition:left 0.5s
        }
        .btn:hover::before{left:100%}
        .btn-primary{
            background:linear-gradient(135deg,var(--primary),var(--primary-dark));
            color:white;border:1px solid var(--primary)
        }
        .btn-primary:hover{
            transform:translateY(-2px);box-shadow:0 0 20px var(--glow-red);
            border-color:var(--accent-blue)
        }
        .btn-secondary{
            background:var(--glass-bg);color:var(--text);border:1px solid var(--accent-purple);
            transition:all 0.3s
        }
        .btn-secondary:hover{
            background:rgba(179,102,255,0.2);box-shadow:0 0 15px rgba(179,102,255,0.3);
            transform:translateY(-2px)
        }
        .container{max-width:1400px;margin:2.5rem auto;padding:0 1.5rem}
        .categories{display:flex;flex-direction:column;gap:1.8rem}
        .cat{
            background:var(--glass-bg);backdrop-filter:blur(20px);border-radius:20px;overflow:hidden;
            border:1px solid rgba(255,23,68,0.1);box-shadow:var(--shadow-lg);transition:all 0.3s;
            position:relative
        }
        .cat::before{
            content:'';position:absolute;top:0;left:0;right:0;height:1px;
            background:linear-gradient(90deg,transparent,var(--primary),transparent);opacity:0;
            transition:opacity 0.3s
        }
        .cat:hover{
            box-shadow:0 0 30px rgba(255,23,68,0.3);border-color:var(--primary);
            transform:translateY(-5px)
        }
        .cat:hover::before{opacity:1}
        .cat-header{
            padding:1.5rem;background:linear-gradient(135deg,rgba(255,23,68,0.15),rgba(179,102,255,0.1));
            border-bottom:1px solid rgba(255,23,68,0.1);font-weight:700;font-size:1.3rem;
            display:flex;align-items:center;gap:0.8rem;letter-spacing:-0.5px
        }
        .cat-header i{
            color:var(--primary);font-size:1.4rem;animation:float 3s ease-in-out infinite
        }
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
        .section{
            display:flex;justify-content:space-between;align-items:center;padding:1.3rem 1.8rem;
            border-bottom:1px solid rgba(255,23,68,0.05);text-decoration:none;color:var(--text);
            transition:all 0.3s;position:relative;cursor:pointer
        }
        .section:last-child{border-bottom:none}
        .section::after{
            content:'';position:absolute;bottom:0;left:0;width:0;height:2px;
            background:linear-gradient(90deg,var(--primary),var(--accent-purple));
            transition:width 0.3s
        }
        .section:hover::after{width:100%}
        .section:hover{
            background:linear-gradient(90deg,rgba(255,23,68,0.1),transparent);
            padding-left:2.2rem;transform:translateX(5px)
        }
        .sec-info{display:flex;align-items:center;gap:1.2rem}
        .sec-info i{
            font-size:1.8rem;color:var(--accent-blue);width:45px;text-align:center;
            transition:all 0.3s
        }
        .section:hover .sec-info i{color:var(--primary);transform:scale(1.2)}
        .sec-title{font-weight:600;font-size:1.1rem;letter-spacing:-0.3px}
        .sec-stats{
            background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(179,102,255,0.1));
            padding:0.5rem 1.2rem;border-radius:25px;font-weight:700;color:var(--accent-blue);
            min-width:60px;text-align:center;border:1px solid rgba(0,212,255,0.2);
            transition:all 0.3s
        }
        .section:hover .sec-stats{
            background:linear-gradient(135deg,rgba(255,23,68,0.2),rgba(179,102,255,0.2));
            color:var(--primary);border-color:var(--primary)
        }
        .breadcrumbs{margin:1.2rem 0;color:var(--text-muted);font-size:0.95rem;display:flex;gap:0.5rem}
        .breadcrumbs span{cursor:pointer;transition:all 0.3s;padding:0.3rem 0.6rem;border-radius:6px}
        .breadcrumbs span:hover{color:var(--primary);background:rgba(255,23,68,0.1)}
        .threads-container,.posts-container{display:flex;flex-direction:column;gap:1.3rem;padding:1.2rem 0}
        .thread-card,.post{
            background:var(--glass-bg);backdrop-filter:blur(10px);padding:1.5rem;border-radius:16px;
            border:1px solid rgba(255,23,68,0.1);transition:all 0.3s;box-shadow:var(--shadow-md);
            position:relative;overflow:hidden
        }
        .thread-card::before,.post::before{
            content:'';position:absolute;top:0;right:-50%;width:100px;height:100px;
            background:radial-gradient(circle,rgba(179,102,255,0.2),transparent);
            border-radius:50%;transition:all 0.3s
        }
        .thread-card:hover::before,.post:hover::before{right:-20%}
        .thread-card:hover,.post:hover{
            transform:translateY(-8px);box-shadow:0 15px 40px rgba(255,23,68,0.2);
            border-color:var(--primary)
        }
        .thread-card h3,.post h3{
            font-size:1.2rem;margin-bottom:0.8rem;letter-spacing:-0.3px;
            position:relative;z-index:1
        }
        .thread-info{
            display:flex;justify-content:space-between;align-items:center;
            margin-top:0.8rem;color:var(--text-muted);font-size:0.9rem;
            position:relative;z-index:1;flex-wrap:wrap;gap:0.5rem
        }
        .post-header{
            display:flex;align-items:center;gap:1rem;margin-bottom:1rem;position:relative;z-index:1
        }
        .post-author{
            font-weight:700;color:var(--accent-blue);cursor:pointer;transition:all 0.3s
        }
        .post-author:hover{color:var(--primary);text-decoration:underline}
        .post-time{color:var(--text-muted);font-size:0.85rem}
        .post-content{margin-bottom:1rem;line-height:1.7;position:relative;z-index:1}
        .post-actions{display:flex;gap:0.8rem;align-items:center;position:relative;z-index:1}
        .post-actions button,.like-btn{
            padding:0.5rem 1rem;background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(179,102,255,0.1));
            color:var(--accent-blue);border:1px solid rgba(0,212,255,0.2);border-radius:8px;
            cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:0.4rem;
            font-weight:600;font-size:0.85rem
        }
        .post-actions button:hover,.like-btn:hover{
            background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            color:white;border-color:var(--primary);transform:scale(1.05)
        }
        .like-btn.liked{color:var(--primary);border-color:var(--primary)}
        .pinned{border:2px solid var(--accent-green);background:rgba(102,255,102,0.05)}
        .new-indicator{
            background:linear-gradient(135deg,#ffb300,#ff8c00);color:white;padding:0.3rem 0.7rem;
            border-radius:20px;font-size:0.75rem;font-weight:700;
            box-shadow:0 0 10px rgba(255,140,0,0.4)
        }
        textarea,input[type="text"],input[type="email"],input[type="password"],input[type="tel"]{
            width:100%;padding:0.9rem;background:var(--glass-bg);border:1px solid rgba(0,212,255,0.2);
            border-radius:12px;color:var(--text);font-size:1rem;font-family:'Poppins',sans-serif;
            transition:all 0.3s;backdrop-filter:blur(10px)
        }
        textarea:focus,input:focus{
            border-color:var(--primary);box-shadow:0 0 20px rgba(255,23,68,0.3);
            outline:none;background:rgba(26,31,58,0.6)
        }
        select{
            width:100%;padding:0.9rem;background:var(--glass-bg);border:1px solid rgba(0,212,255,0.2);
            border-radius:12px;color:var(--text);font-size:1rem;cursor:pointer;font-family:'Poppins',sans-serif;
            transition:all 0.3s;backdrop-filter:blur(10px)
        }
        select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 20px rgba(255,23,68,0.3)}
        .modal{
            display:none;position:fixed;top:0;left:0;width:100%;height:100%;
            background:rgba(0,0,0,0.7);backdrop-filter:blur(5px);z-index:2000;
            align-items:center;justify-content:center;animation:fadeIn 0.3s ease
        }
        .modal.active{display:flex}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        @keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
        .modal-content{
            background:var(--glass-bg);border-radius:20px;padding:2.5rem;max-width:500px;width:90%;
            border:1px solid rgba(255,23,68,0.2);box-shadow:var(--shadow-lg);animation:slideUp 0.3s ease;
            backdrop-filter:blur(20px)
        }
        .modal-header h2{
            font-size:2rem;background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-0.5px
        }
        .form-group{margin-bottom:1.8rem}
        .form-group label{
            display:block;margin-bottom:0.7rem;color:var(--accent-blue);font-weight:600;
            letter-spacing:-0.3px
        }
        .form-actions{display:flex;gap:1.2rem;margin-top:2rem}
        .form-actions .btn{flex:1}
        .profile-section{
            background:var(--glass-bg);backdrop-filter:blur(20px);border-radius:20px;padding:2.5rem;
            border:1px solid rgba(255,23,68,0.1);box-shadow:var(--shadow-lg)
        }
        .profile-header{display:flex;align-items:center;gap:2rem;margin-bottom:2.5rem}
        .profile-avatar-large{
            width:120px;height:120px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            background-size:cover;background-position:center;box-shadow:0 0 30px var(--glow-red);
            display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:800;
            border:3px solid var(--primary)
        }
        .profile-details h2{font-size:2.2rem;margin-bottom:0.8rem;letter-spacing:-0.5px}
        .tabs{display:flex;gap:1.2rem;margin-bottom:2.5rem;border-bottom:2px solid rgba(255,23,68,0.1)}
        .tab{
            padding:1.2rem 1.8rem;cursor:pointer;color:var(--text-muted);font-weight:600;
            transition:all 0.3s;border-bottom:3px solid transparent;margin-bottom:-2px;
            letter-spacing:-0.3px;position:relative
        }
        .tab:hover{color:var(--primary)}
        .tab.active{
            color:var(--primary);border-bottom-color:var(--primary);
            background:rgba(255,23,68,0.1);border-radius:8px 8px 0 0
        }
        .tab-content{display:none}
        .tab-content.active{display:block;animation:slideUp 0.3s ease}
        .info-grid{
            display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem
        }
        .info-item{
            background:linear-gradient(135deg,rgba(0,212,255,0.1),rgba(179,102,255,0.1));
            padding:1.5rem;border-radius:12px;border:1px solid rgba(0,212,255,0.2);
            transition:all 0.3s
        }
        .info-item:hover{
            border-color:var(--primary);background:linear-gradient(135deg,rgba(255,23,68,0.1),rgba(179,102,255,0.1));
            transform:translateY(-3px)
        }
        .info-label{color:var(--text-muted);font-size:0.9rem;margin-bottom:0.6rem;font-weight:600}
        .info-value{font-size:1.2rem;font-weight:700;letter-spacing:-0.3px}
        #loading{
            position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
            background:var(--glass-bg);padding:2rem 3rem;border-radius:16px;
            display:none;z-index:3000;box-shadow:var(--shadow-lg);border:1px solid var(--primary);
            color:var(--primary);font-weight:700;animation:pulse 2s infinite
        }
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
        #toast{
            position:fixed;bottom:20px;right:20px;color:white;padding:1rem 2rem;
            border-radius:12px;display:none;z-index:3000;box-shadow:var(--shadow-md);
            animation:slideUp 0.3s ease;font-weight:600;border:1px solid rgba(255,255,255,0.1)
        }
        @media (max-width:768px){
            .nav-content{flex-direction:column;gap:1rem}.container{padding:0 1rem}
            .section{flex-direction:column;align-items:flex-start;gap:0.8rem;padding:1rem}
            .sec-stats{align-self:flex-end}.post-header{flex-direction:column;align-items:flex-start}
            .btn{padding:0.8rem 1.5rem;font-size:0.9rem}.profile-header{flex-direction:column}
        }
        .fullscreen-modal{
            display:none;position:fixed;top:0;left:0;width:100%;height:100%;
            background:rgba(0,0,0,0.8);z-index:3000;align-items:center;justify-content:center;
            animation:fadeIn 0.3s ease;backdrop-filter:blur(5px)
        }
        .fullscreen-modal.active{display:flex}
        .modal-carousel{
            max-width:800px;width:90%;text-align:center;position:relative;padding:3rem;
            background:var(--glass-bg);border-radius:20px;border:1px solid rgba(255,23,68,0.2);
            backdrop-filter:blur(20px)
        }
        .carousel-slide{display:none;animation:slideUp 0.5s ease}
        .carousel-slide.active{display:block}
        .carousel-title{
            font-size:3.2rem;margin-bottom:1.5rem;font-weight:800;
            background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;
            letter-spacing:-1px
        }
        .carousel-description{
            font-size:1.2rem;line-height:1.8;color:var(--text-muted);margin-bottom:2.5rem;
            letter-spacing:-0.3px
        }
        .carousel-nav{
            position:absolute;top:50%;transform:translateY(-50%);
            background:linear-gradient(135deg,rgba(0,212,255,0.2),rgba(179,102,255,0.2));
            border:2px solid var(--primary);color:var(--primary);font-size:1.5rem;
            width:60px;height:60px;border-radius:50%;cursor:pointer;transition:all 0.3s;
            display:flex;align-items:center;justify-content:center
        }
        .carousel-nav:hover{
            background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            color:white;border-color:white;transform:translateY(-50%) scale(1.1)
        }
        .carousel-nav.prev{left:-80px}.carousel-nav.next{right:-80px}
        .carousel-actions{display:flex;gap:1.5rem;justify-content:center;margin-top:2rem;flex-wrap:wrap}
        .carousel-actions .btn{min-width:180px;padding:1rem 2rem;font-size:1rem}
        .carousel-dots{display:flex;gap:0.8rem;justify-content:center;margin-top:2rem}
        .carousel-dot{
            width:14px;height:14px;border-radius:50%;background:rgba(0,212,255,0.3);
            cursor:pointer;transition:all 0.3s;border:2px solid transparent
        }
        .carousel-dot.active{
            background:linear-gradient(135deg,var(--primary),var(--accent-purple));
            border-color:white;transform:scale(1.3)
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/OGSunny/Testerweb/main/zaratic.png" alt="Logo">
                <span><i class="fas fa-gamepad"></i> Zaratic RP</span>
            </div>
            <div class="nav-actions" id="navActions">
                <button class="btn btn-primary" onclick="showWelcomeModal()">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
                <button class="btn btn-secondary" onclick="showWelcomeModal()">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="forumView">
            <div class="categories">
                <div class="cat">
                    <div class="cat-header">ğŸ“‹ áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</div>
                    <a href="#" class="section" data-section="rules" data-view-only="true">
                        <div class="sec-info">
                            <i class="fas fa-book"></i>
                            <div class="sec-title">áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ¬áƒ”áƒ¡áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="news" data-view-only="true">
                        <div class="sec-info">
                            <i class="fas fa-bullhorn"></i>
                            <div class="sec-title">áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="updates" data-view-only="true">
                        <div class="sec-info">
                            <i class="fas fa-sync"></i>
                            <div class="sec-title">áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                </div>
                <div class="cat">
                    <div class="cat-header">ğŸ‘¥ áƒ¡áƒáƒ–áƒáƒ’áƒáƒ“áƒáƒ”áƒ‘áƒ</div>
                    <a href="#" class="section" data-section="suggestions">
                        <div class="sec-info">
                            <i class="fas fa-lightbulb"></i>
                            <div class="sec-title">áƒ¬áƒ˜áƒœáƒáƒ“áƒáƒ“áƒ”áƒ‘áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="events">
                        <div class="sec-info">
                            <i class="fas fa-calendar"></i>
                            <div class="sec-title">áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="biographies">
                        <div class="sec-info">
                            <i class="fas fa-user-edit"></i>
                            <div class="sec-title">áƒ‘áƒ˜áƒáƒ’áƒ áƒáƒ¤áƒ˜áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                </div>
                <div class="cat">
                    <div class="cat-header">âš ï¸ áƒ¡áƒáƒ©áƒ˜áƒ•áƒ áƒ”áƒ‘áƒ˜</div>
                    <a href="#" class="section" data-section="complaints-admin">
                        <div class="sec-info">
                            <i class="fas fa-user-shield"></i>
                            <div class="sec-title">áƒáƒ“áƒ›áƒ˜áƒœáƒ–áƒ”</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="complaints-player">
                        <div class="sec-info">
                            <i class="fas fa-user-slash"></i>
                            <div class="sec-title">áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ–áƒ”</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="appeals">
                        <div class="sec-info">
                            <i class="fas fa-gavel"></i>
                            <div class="sec-title">áƒáƒáƒ”áƒšáƒáƒªáƒ˜áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="unban">
                        <div class="sec-info">
                            <i class="fas fa-unlock"></i>
                            <div class="sec-title">áƒ’áƒáƒœáƒ‘áƒšáƒáƒ™áƒ•áƒ</div>
                        </div>
                        <div class="sec-stats">0</div> 
                </a>
                </div>
                <div class="cat">
                    <div class="cat-header">ğŸ’¼ áƒ•áƒáƒ™áƒáƒœáƒ¡áƒ˜áƒ”áƒ‘áƒ˜</div>
                    <a href="#" class="section" data-section="vacancies-leaders">
                        <div class="sec-info">
                            <i class="fas fa-crown"></i>
                            <div class="sec-title">áƒšáƒ˜áƒ“áƒ”áƒ áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="vacancies-admin">
                        <div class="sec-info">
                            <i class="fas fa-user-shield"></i>
                            <div class="sec-title">áƒáƒ“áƒ›áƒ˜áƒœáƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="vacancies-partner">
                        <div class="sec-info">
                            <i class="fas fa-handshake"></i>
                            <div class="sec-title">áƒáƒáƒ áƒ¢áƒœáƒ˜áƒáƒ áƒ”áƒ‘áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                </div>
                <div class="cat">
                    <div class="cat-header">ğŸ”§ áƒ¢áƒ”áƒ¥áƒœáƒ˜áƒ™áƒ£áƒ áƒ˜</div>
                    <a href="#" class="section" data-section="donation-help">
                        <div class="sec-info">
                            <i class="fas fa-heart"></i>
                            <div class="sec-title">áƒ“áƒáƒœáƒáƒ¢áƒ˜</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="tech-help">
                        <div class="sec-info">
                            <i class="fas fa-tools"></i>
                            <div class="sec-title">áƒ¢áƒ”áƒ¥. áƒ“áƒáƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                    <a href="#" class="section" data-section="general">
                        <div class="sec-info">
                            <i class="fas fa-comments"></i>
                            <div class="sec-title">áƒ“áƒ˜áƒ¡áƒ™áƒ£áƒ¡áƒ˜áƒ</div>
                        </div>
                        <div class="sec-stats">0</div>
                    </a>
                </div>
            </div>
        </div>

        <div id="sectionView" style="display:none">
            <div class="breadcrumbs" id="sectionBreadcrumbs"></div>
            <button class="btn btn-secondary" onclick="backToForumFromSection()"><i class="fas fa-arrow-left"></i> áƒ£áƒ™áƒáƒœ</button>
            <h2 id="sectionTitle" style="margin:1rem 0"></h2>
            <button class="btn btn-primary" onclick="showNewThreadModal()">áƒáƒ®áƒáƒšáƒ˜ áƒ—áƒ áƒ”áƒ“áƒ˜</button>
            <div class="threads-container" id="threadsList"></div>
        </div>

        <div id="threadView" style="display:none">
            <div class="breadcrumbs" id="threadBreadcrumbs"></div>
            <button class="btn btn-secondary" onclick="backToSectionFromThread()"><i class="fas fa-arrow-left"></i> áƒ£áƒ™áƒáƒœ</button>
            <h2 id="threadTitle" style="margin:1rem 0"></h2>
            <div class="posts-container" id="threadPosts"></div>
            <form id="newReplyForm">
                <div class="form-group">
                    <textarea id="replyContent" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒáƒ¡áƒ£áƒ®áƒ˜..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">áƒáƒáƒ¡áƒ£áƒ®áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
            </form>
        </div>

        <div id="profileView" style="display:none">
            <div class="profile-section">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profileAvatarLarge"></div>
                    <div class="profile-details">
                        <h2 id="profileUsername">Username</h2>
                        <div class="user-badges" id="profileBadges"></div>
                    </div>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('info')">áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ</div>
                    <div class="tab" onclick="switchTab('edit')">áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</div>
                    <div class="tab" onclick="switchTab('admin')" id="adminTab" style="display:none">áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒáƒœáƒ”áƒšáƒ˜</div>
                </div>
                <div id="infoTab" class="tab-content active">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</div>
                            <div class="info-value" id="displayName">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ</div>
                            <div class="info-value" id="displayEmail">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</div>
                            <div class="info-value" id="displayPhone">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">áƒ‘áƒ˜áƒ</div>
                            <div class="info-value" id="displayBio">-</div>
                        </div>
                    </div>
                </div>
                <div id="editTab" class="tab-content">
                    <form id="profileEditForm">
                        <div class="form-group">
                            <label>áƒáƒ•áƒáƒ¢áƒáƒ áƒ˜</label>
                            <div style="display:flex;align-items:center;gap:1rem">
                                <div id="avatarPreview" class="user-avatar" style="width:60px;height:60px"></div>
                                <input type="file" id="editAvatar" accept="image/*" onchange="previewAvatar(this)">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</label>
                            <input type="text" id="editName" placeholder="áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
                        </div>
                        <div class="form-group">
                            <label>áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ</label>
                            <input type="email" id="editEmail" placeholder="email@example.com">
                        </div>
                        <div class="form-group">
                            <label>áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</label>
                            <input type="tel" id="editPhone" placeholder="+995 XXX XXX XXX">
                        </div>
                        <div class="form-group">
                            <label>áƒ‘áƒ˜áƒ</label>
                            <input type="text" id="editBio" placeholder="áƒ áƒáƒ›áƒ” áƒ—áƒ¥áƒ•áƒ”áƒœáƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘...">
                        </div>
                        <button type="submit" class="btn btn-primary">áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
                    </form>
                </div>
                <div id="adminTab" class="tab-content">
                    <h3 style="margin-bottom:1rem">áƒ‘áƒ”áƒ¯áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h3>
                    <div style="background:var(--dark-lighter);padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;border:1px solid rgba(0,212,255,0.2)">
                        <h4 style="margin-bottom:1rem;color:var(--accent-blue)">áƒ‘áƒ”áƒ¯áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</h4>
                        <div class="form-group">
                            <label>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</label>
                            <input type="text" id="badgeUsername" placeholder="Username">
                        </div>
                        <div class="form-group">
                            <label>áƒ‘áƒ”áƒ¯áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</label>
                            <input type="text" id="badgeName" placeholder="áƒ›áƒáƒ’: VIP">
                        </div>
                        <button class="btn btn-primary" onclick="assignBadge()">áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</button>
                    </div>
                    <div style="background:var(--dark-lighter);padding:1.5rem;border-radius:12px;border:1px solid rgba(255,23,68,0.2)">
                        <h4 style="margin-bottom:1rem;color:var(--primary)">áƒ‘áƒ”áƒ¯áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ</h4>
                        <div class="form-group">
                            <label>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</label>
                            <input type="text" id="removeBadgeUsername" placeholder="Username">
                        </div>
                        <div class="form-group">
                            <label>áƒ‘áƒ”áƒ¯áƒ˜</label>
                            <input type="text" id="removeBadgeName" placeholder="áƒ‘áƒ”áƒ¯áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
                        </div>
                        <button class="btn btn-secondary" style="background:linear-gradient(135deg,var(--primary),var(--primary-dark))" onclick="removeBadge()">áƒ¬áƒáƒ¨áƒšáƒ</button>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="backToForum()" style="margin-top:2rem">
                    <i class="fas fa-arrow-left"></i> áƒ£áƒ™áƒáƒœ áƒ¤áƒáƒ áƒ£áƒ›áƒ–áƒ”
                </button>
            </div>
        </div>
    </div>

    <div id="welcomeModal" class="fullscreen-modal">
        <div class="modal-carousel">
            <button class="carousel-nav prev" onclick="prevSlide()"><i class="fas fa-chevron-left"></i></button>
            <button class="carousel-nav next" onclick="nextSlide()"><i class="fas fa-chevron-right"></i></button>
            <div class="carousel-slide active">
                <h2 class="carousel-title">áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ— Zaratic RP-áƒ¡ áƒ¤áƒáƒ áƒ£áƒ›áƒ–áƒ”</h2>
                <p class="carousel-description">áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ”áƒ¬áƒ•áƒ˜áƒ”áƒ— Zaratic Role Play-áƒ¡ áƒ¤áƒáƒ áƒ£áƒ›áƒ¡, áƒ áƒáƒ’áƒáƒ áƒª áƒ¡áƒ¢áƒ£áƒ›áƒáƒ áƒ˜. áƒ˜áƒ›áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ áƒáƒ› áƒ’áƒáƒ”áƒªáƒœáƒáƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ¡áƒáƒ™áƒ˜áƒ—áƒ®áƒ¡ áƒ¡áƒ áƒ£áƒšáƒáƒ“, áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ’áƒáƒ˜áƒáƒ áƒáƒ— áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ áƒáƒœ áƒáƒ•áƒ¢áƒáƒ áƒ˜áƒ–áƒáƒªáƒ˜áƒ.</p>
            </div>
            <div class="carousel-slide">
                <h2 class="carousel-title">Zaratic Role Play</h2>
                <p class="carousel-description">áƒ¨áƒ”áƒ›áƒáƒ’áƒ•áƒ˜áƒ”áƒ áƒ—áƒ“áƒ˜ áƒ“áƒ áƒ’áƒáƒ®áƒ“áƒ˜ áƒ©áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒáƒ–áƒáƒ’áƒáƒ“áƒáƒ”áƒ‘áƒ˜áƒ¡ áƒœáƒáƒ¬áƒ˜áƒšáƒ˜! áƒ›áƒáƒ’áƒ•áƒ”áƒšáƒ˜áƒ— áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¡áƒáƒ£áƒ™áƒ”áƒ—áƒ”áƒ¡áƒ áƒ’áƒáƒ›áƒáƒªáƒ“áƒ˜áƒšáƒ”áƒ‘áƒ, áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ¡áƒáƒ–áƒáƒ’áƒáƒ“áƒáƒ”áƒ‘áƒ áƒ“áƒ áƒ£áƒáƒ›áƒ áƒáƒ•áƒ˜ áƒ¨áƒ”áƒ¡áƒáƒ«áƒšáƒ”áƒ‘áƒšáƒáƒ‘áƒ.</p>
            </div>
            <div class="carousel-actions">
                <button class="btn btn-primary" onclick="showRegister()"><i class="fas fa-user-plus"></i> áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</button>
                <button class="btn btn-secondary" onclick="showLogin()"><i class="fas fa-sign-in-alt"></i> áƒáƒ•áƒ¢áƒáƒ áƒ˜áƒ–áƒáƒªáƒ˜áƒ</button>
            </div>
            <div class="carousel-dots">
                <div class="carousel-dot active" onclick="showSlide(0)"></div>
                <div class="carousel-dot" onclick="showSlide(1)"></div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</h2></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</label>
                    <input type="text" id="loginUsername" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <label>áƒáƒáƒ áƒáƒšáƒ˜</label>
                    <input type="password" id="loginPassword" placeholder="Password" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('loginModal')">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</h2></div>
            <form id="registerForm">
                <div class="form-group">
                    <label>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</label>
                    <input type="text" id="regUsername" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <label>áƒ”áƒš. áƒ¤áƒáƒ¡áƒ¢áƒ</label>
                    <input type="email" id="regEmail" placeholder="email@example.com" required>
                </div>
                <div class="form-group">
                    <label>áƒáƒáƒ áƒáƒšáƒ˜ (áƒ›áƒ˜áƒœ. 8 áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ)</label>
                    <input type="password" id="regPassword" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('registerModal')">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="verifyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ•áƒ”áƒ áƒ˜áƒ¤áƒ˜áƒ™áƒáƒªáƒ˜áƒ</h2></div>
            <form id="verifyForm">
                <div class="form-group">
                    <label>áƒ•áƒ”áƒ áƒ˜áƒ¤áƒ˜áƒ™áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ™áƒáƒ“áƒ˜ (8 áƒªáƒ˜áƒ¤áƒ áƒ˜)</label>
                    <input type="text" id="verifyCode" placeholder="12345678" maxlength="8" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">áƒ“áƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ”áƒ‘áƒ</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('verifyModal')">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="newThreadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>áƒáƒ®áƒáƒšáƒ˜ áƒ—áƒ áƒ”áƒ“áƒ˜</h2></div>
            <form id="newThreadForm">
                <div class="form-group">
                    <label>áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</label>
                    <input type="text" id="threadTitleInput" placeholder="áƒ—áƒ áƒ”áƒ“áƒ˜áƒ¡ áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜" required>
                </div>
                <div class="form-group">
                    <label>áƒ¨áƒ˜áƒœáƒáƒáƒ áƒ¡áƒ˜</label>
                    <textarea id="threadContent" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒáƒ¡áƒ¢áƒ˜..." rows="6" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('newThreadModal')">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                </div>
            </form>
        </div>
    </div>

    <div id="loading">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</div>
    <div id="toast"></div>

    <script>
        const API_URL = 'https://data7167.jemalagegidze.workers.dev';
        emailjs.init('6mfdsM4fGZ9WWDFst');

        let currentUser = null;
        let userData = null;
        let currentSection = null;
        let currentThread = null;
        let sectionPosts = [];
        let refreshInterval = null;
        const storageKey = 'zaraticForum_v2';
        let localData = JSON.parse(localStorage.getItem(storageKey)) || { token: null };

        async function api(path, options = {}) {
            console.log(`API REQUEST â†’ ${options.method || 'GET'} ${API_URL}${path}`);
            const headers = { 'Content-Type': 'application/json', ...options.headers };
            if (localData.token) headers['Authorization'] = `Bearer ${localData.token}`;

            let res;
            try {
                res = await fetch(API_URL + path, { ...options, headers });
                console.log(`API RESPONSE â† ${res.status} ${path}`);
            } catch (err) {
                console.error('áƒ¥áƒ¡áƒ”áƒšáƒ˜áƒ¡ áƒáƒœ CORS áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ:', err);
                showToast('áƒ˜áƒœáƒ¢áƒ”áƒ áƒœáƒ”áƒ¢áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒáƒ áƒáƒ‘áƒšáƒ”áƒ›áƒ áƒáƒœ áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜ áƒ›áƒ˜áƒ£áƒ¬áƒ•áƒ“áƒáƒ›áƒ”áƒšáƒ˜áƒ', 'error');
                return null;
            }

            if (res.status === 401 || res.status === 403) {
                logout();
                showToast('áƒ¡áƒ”áƒ¡áƒ˜áƒ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ. áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒ’áƒáƒ˜áƒáƒ áƒáƒ— áƒáƒ•áƒ¢áƒáƒ áƒ˜áƒ–áƒáƒªáƒ˜áƒ', 'error');
                return res;
            }

            if (!res.ok) {
                let errorMsg = res.statusText;
                try {
                    const errData = await res.clone().json();
                    errorMsg = errData.message || errorMsg;
                } catch {}
                console.error(`API ERROR ${res.status} ${path}: ${errorMsg}`);
                showToast(errorMsg || 'áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ', 'error');
            }

            return res;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'success' ? 'linear-gradient(135deg,var(--accent-green),#00cc00)' : 'linear-gradient(135deg,var(--primary),var(--primary-dark))';
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 4000);
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function formatTime(time) {
            const diff = Date.now() - time;
            if (diff < 60000) return 'áƒáƒ®áƒšáƒáƒ®áƒáƒœáƒ¡';
            if (diff < 3600000) return `${Math.floor(diff/60000)} áƒ¬áƒ£áƒ—áƒ˜áƒ¡ áƒ¬áƒ˜áƒœ`;
            if (diff < 86400000) return `${Math.floor(diff/3600000)} áƒ¡áƒáƒáƒ—áƒ˜áƒ¡ áƒ¬áƒ˜áƒœ`;
            if (diff < 604800000) return `${Math.floor(diff/86400000)} áƒ“áƒ¦áƒ˜áƒ¡ áƒ¬áƒ˜áƒœ`;
            return new Date(time).toLocaleString('ka-GE');
        }

        function isNew(time) {
            return Date.now() - time < 3600000;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getBadgeColor(name) {
            const colors = {
                admin: ['#ff1744', '#c41c3b'], 
                tech: ['#00d4ff', '#0099cc'], 
                player: ['#8b5a8e', '#6a4570'], 
                vip: ['#ffb300', '#ff8c00'], 
                moderator: ['#66ff66', '#00cc00'], 
                helper: ['#b366ff', '#9933ff']
            };
            name = name.toLowerCase();
            if (colors[name]) return `linear-gradient(135deg, ${colors[name][0]}, ${colors[name][1]})`;
            let hash = 0;
            for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
            const hue = Math.abs(hash) % 360;
            return `linear-gradient(135deg, hsl(${hue},70%,60%), hsl(${hue},70%,45%))`;
        }

        function renderBadge(name) {
            return `<span class="badge" style="background:${getBadgeColor(name)}" title="${name.toUpperCase()}">${name.toUpperCase()}</span>`;
        }

        function updateUI() {
            if (!userData) return;
            const avatarStyle = userData.profile.avatar ? `background-image:url(${userData.profile.avatar});background-size:cover;background-position:center;` : '';
            const avatarText = userData.profile.avatar ? '' : currentUser[0].toUpperCase();
            document.getElementById('navActions').innerHTML = `
                <div class="user-info" onclick="showProfile()">
                    <div class="user-avatar" style="${avatarStyle}">${avatarText}</div>
                    <span>${currentUser}</span>
                    <div class="user-badges">${userData.badges.map(renderBadge).join('')}</div>
                </div>
                <button class="btn btn-secondary" onclick="logout()"><i class="fas fa-sign-out-alt"></i> áƒ’áƒáƒ¡áƒ•áƒšáƒ</button>
            `;
        }

        async function updateSectionStats() {
            const res = await api('/post-counts');
            if (res && res.ok) {
                const counts = await res.json();
                document.querySelectorAll('.section').forEach(el => {
                    const count = counts[el.dataset.section] || 0;
                    el.querySelector('.sec-stats').textContent = count;
                });
            }
        }

        async function fetchPosts() {
            const res = await api(`/posts/${currentSection}`);
            if (res && res.ok) {
                sectionPosts = await res.json();
            } else {
                sectionPosts = [];
                console.warn(`áƒáƒáƒ¡áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ áƒ¡áƒ”áƒ¥áƒªáƒ˜áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡: ${currentSection}`);
            }
            return sectionPosts;
        }

        async function renderThreads() {
            await fetchPosts();
            const list = document.getElementById('threadsList');
            list.innerHTML = '';
            const threads = sectionPosts.filter(p => !p.parentId)
                .sort((a, b) => b.pinned - a.pinned || b.time - a.time);

            if (threads.length === 0) {
                list.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:2rem">áƒ—áƒ áƒ”áƒ“áƒ”áƒ‘áƒ˜ áƒáƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p>';
            }

            threads.forEach(thread => {
                const replies = sectionPosts.filter(p => p.parentId === thread.id).length;
                const lastActivity = formatTime(Math.max(thread.time, ...sectionPosts.filter(p => p.parentId === thread.id).map(p => p.time) || [thread.time]));
                const newInd = isNew(thread.time) ? '<span class="new-indicator">áƒáƒ®áƒáƒšáƒ˜</span>' : '';
                const pinnedClass = thread.pinned ? ' pinned' : '';

                const div = document.createElement('div');
                div.className = `thread-card${pinnedClass}`;
                div.innerHTML = `
                    <h3>${escapeHtml(thread.title || thread.content.substring(0,60)+'...')}${newInd}</h3>
                    <div class="thread-info">
                        <span><i class="fas fa-user"></i> ${thread.author}</span>
                        <span><i class="fas fa-comments"></i> áƒáƒáƒ¡áƒ£áƒ®áƒ”áƒ‘áƒ˜: ${replies}</span>
                        <span><i class="fas fa-clock"></i> ${lastActivity}</span>
                    </div>
                    ${userData?.role === 'admin' ? `
                        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
                            <button class="btn btn-secondary" onclick="event.stopPropagation(); togglePin('${thread.id}')" style="font-size:0.85rem;padding:0.4rem 0.8rem">
                                <i class="fas fa-${thread.pinned ? 'times' : 'thumbtack'}"></i> ${thread.pinned ? 'áƒ’áƒáƒœáƒáƒ˜áƒœáƒ”áƒ‘áƒ' : 'áƒ“áƒáƒ¤áƒ˜áƒ¥áƒ¡áƒ˜áƒ áƒ”áƒ‘áƒ'}
                            </button>
                            <button class="btn btn-secondary" style="background:linear-gradient(135deg,var(--primary),var(--primary-dark));font-size:0.85rem;padding:0.4rem 0.8rem" onclick="event.stopPropagation(); deleteThread('${thread.id}')">
                                <i class="fas fa-trash"></i> áƒ¬áƒáƒ¨áƒšáƒ
                            </button>
                        </div>
                    ` : ''}
                `;
                div.onclick = (e) => {
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                    openThread(thread.id, thread.title || thread.content.substring(0,60) + '...');
                };
                list.appendChild(div);
            });
        }

        async function renderThread() {
            await fetchPosts();
            const container = document.getElementById('threadPosts');
            container.innerHTML = '';
            const thread = sectionPosts.find(p => p.id === currentThread);
            if (!thread) {
                container.innerHTML = '<p style="text-align:center;color:var(--text-muted)">áƒ—áƒ áƒ”áƒ“áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p>';
                return;
            }
            container.appendChild(createPostElement(thread, false));
            sectionPosts.filter(p => p.parentId === currentThread)
                .sort((a,b) => a.time - b.time)
                .forEach(p => container.appendChild(createPostElement(p, true)));
        }

        function createPostElement(post, isReply) {
            const avatarStyle = post.avatar ? `background-image:url(${post.avatar});background-size:cover;background-position:center;` : '';
            const avatarText = post.avatar ? '' : post.author[0].toUpperCase();
            const liked = post.likes?.includes(currentUser) ? 'liked' : '';
            const pinned = post.pinned && !isReply ? ' pinned' : '';
            const div = document.createElement('div');
            div.className = `post${pinned}`;
            div.innerHTML = `
                <div class="post-header">
                    <div class="user-avatar" style="${avatarStyle}">${avatarText}</div>
                    <span class="post-author" onclick="viewUserProfile('${post.author}')">${post.author}</span>
                    <div class="user-badges">${(post.badges || []).map(renderBadge).join('')}</div>
                    <span class="post-time">${formatTime(post.time)}</span>
                </div>
                ${!isReply ? `<h3>${escapeHtml(post.title || '')}</h3>` : ''}
                <div class="post-content">${escapeHtml(post.content).replace(/\n/g, '<br>')}</div>
                <div class="post-actions">
                    <button class="like-btn ${liked}" onclick="toggleLike('${post.id}')"><i class="fas fa-heart"></i> ${post.likes?.length || 0}</button>
                </div>
            `;
            return div;
        }

        function openThread(id, title) {
            currentThread = id;
            document.getElementById('sectionView').style.display = 'none';
            document.getElementById('threadView').style.display = 'block';
            document.getElementById('threadTitle').textContent = title;
            document.getElementById('newReplyForm').style.display = currentUser ? 'block' : 'none';
            updateBreadcrumbs('thread');
            renderThread();
            clearInterval(refreshInterval);
            refreshInterval = setInterval(renderThread, 30000);
        }

        function updateBreadcrumbs(type) {
            if (type === 'section') {
                const sectionEl = document.querySelector(`.section[data-section="${currentSection}"]`);
                const cat = sectionEl.closest('.cat').querySelector('.cat-header').textContent.trim();
                const sec = sectionEl.querySelector('.sec-title').textContent.trim();
                document.getElementById('sectionBreadcrumbs').innerHTML = `<span onclick="backToForumFromSection()" style="cursor:pointer">áƒ¤áƒáƒ áƒ£áƒ›áƒ˜</span> â†’ ${cat} â†’ ${sec}`;
            } else if (type === 'thread') {
                const threadTitle = document.getElementById('threadTitle').textContent;
                document.getElementById('threadBreadcrumbs').innerHTML = document.getElementById('sectionBreadcrumbs').innerHTML + ` â†’ ${threadTitle}`;
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            const res = await api('/login', {
                method: 'POST',
                body: JSON.stringify({username, password})
            });

            if (!res || !res.ok) {
                showToast('áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒáƒœ áƒáƒáƒ áƒáƒšáƒ˜', 'error');
                return;
            }

            const data = await res.json();
            localData.token = data.token;
            currentUser = data.user.username;
            userData = data.user;
            localStorage.setItem(storageKey, JSON.stringify(localData));
            updateUI();
            closeModal('loginModal');
            showToast('áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—!');
            updateSectionStats();
        }

        async function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;

            if (password.length < 8) {
                showToast('áƒáƒáƒ áƒáƒšáƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ›áƒ˜áƒœáƒ˜áƒ›áƒ£áƒ› 8 áƒ¡áƒ˜áƒ›áƒ‘áƒáƒšáƒ', 'error');
                return;
            }

            const code = String(Math.floor(10000000 + Math.random() * 90000000));

            try {
                await emailjs.send('service_uqvxc6o', 'Zaraticsregister9178', {
                    to_email: email,
                    to_name: username,
                    code: code
                });
                console.log('EmailJS áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ');

                const res = await api('/register', {
                    method: 'POST',
                    body: JSON.stringify({username, email, password, code})
                });

                if (!res || !res.ok) {
                    showToast('áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ (áƒ¨áƒ”áƒ¡áƒáƒ«áƒšáƒáƒ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ£áƒ™áƒ•áƒ” áƒáƒ áƒ¡áƒ”áƒ‘áƒáƒ‘áƒ¡)', 'error');
                    return;
                }

                sessionStorage.setItem('pendingEmail', email);
                closeModal('registerModal');
                document.getElementById('verifyModal').classList.add('active');
                showToast('áƒ™áƒáƒ“áƒ˜ áƒ’áƒáƒ›áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒšáƒ˜áƒ áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒáƒ–áƒ”');
            } catch (err) {
                console.error('EmailJS áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ:', err);
                showToast('áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ˜áƒ¡ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ', 'error');
            }
        }

        async function handleVerify(e) {
            e.preventDefault();
            const code = document.getElementById('verifyCode').value.trim();
            const email = sessionStorage.getItem('pendingEmail');

            const res = await api('/verify', {
                method: 'POST',
                body: JSON.stringify({email, code})
            });

            if (!res || !res.ok) {
                showToast('áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ™áƒáƒ“áƒ˜', 'error');
                return;
            }

            const data = await res.json();
            localData.token = data.token;
            currentUser = data.user.username;
            userData = data.user;
            localStorage.setItem(storageKey, JSON.stringify(localData));
            updateUI();
            closeModal('verifyModal');
            sessionStorage.removeItem('pendingEmail');
            showToast('áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ!');
            updateSectionStats();
        }

        async function togglePin(postId) {
            if (userData?.role !== 'admin') return;
            const res = await api(`/posts/${currentSection}/${postId}/pin`, {method: 'POST'});
            if (res && res.ok) {
                currentThread ? renderThread() : renderThreads();
            }
        }

        async function deleteThread(threadId) {
            if (userData?.role !== 'admin') return;
            if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ—áƒ áƒ”áƒ“áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')) return;

            const res = await api(`/posts/${currentSection}/delete`, {
                method: 'POST',
                body: JSON.stringify({threadId})
            });

            if (res && res.ok) {
                await fetchPosts();
                renderThreads();
                updateSectionStats();
                showToast('áƒ—áƒ áƒ”áƒ“áƒ˜ áƒ¬áƒáƒ¨áƒšáƒ˜áƒšáƒ˜áƒ');
            }
        }

        async function toggleLike(postId) {
            const res = await api(`/posts/${currentSection}/${postId}/like`, {method: 'POST'});
            if (res && res.ok) {
                currentThread ? renderThread() : renderThreads();
            }
        }

        async function handleNewThread(e) {
            e.preventDefault();
            const title = document.getElementById('threadTitleInput').value.trim();
            const content = document.getElementById('threadContent').value.trim();

            const res = await api(`/posts/${currentSection}`, {
                method: 'POST',
                body: JSON.stringify({title, content})
            });

            if (res && res.ok) {
                closeModal('newThreadModal');
                renderThreads();
                updateSectionStats();
                showToast('áƒ—áƒ áƒ”áƒ“áƒ˜ áƒ¨áƒ”áƒ˜áƒ¥áƒ›áƒœáƒ');
            } else {
                showToast('áƒ—áƒ áƒ”áƒ“áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ', 'error');
            }
        }

        async function handleNewReply(e) {
            e.preventDefault();
            const content = document.getElementById('replyContent').value.trim();

            const res = await api(`/posts/${currentSection}`, {
                method: 'POST',
                body: JSON.stringify({content, parentId: currentThread})
            });

            if (res && res.ok) {
                document.getElementById('replyContent').value = '';
                renderThread();
                updateSectionStats();
                showToast('áƒáƒáƒ¡áƒ£áƒ®áƒ˜ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒšáƒ˜áƒ');
            }
        }

        function previewAvatar(input) {
            if (input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => document.getElementById('avatarPreview').style.backgroundImage = `url(${e.target.result})`;
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function showProfile() {
            const res = await api('/me');
            if (!res || !res.ok) {
                logout();
                return;
            }

            const data = await res.json();
            userData = data;
            currentUser = data.username;

            document.getElementById('forumView').style.display = 'none';
            document.getElementById('sectionView').style.display = 'none';
            document.getElementById('threadView').style.display = 'none';
            document.getElementById('profileView').style.display = 'block';

            const avatarStyle = data.profile.avatar ? `background-image:url(${data.profile.avatar});background-size:cover;background-position:center;` : 'background:linear-gradient(135deg,var(--primary),var(--secondary));';
            document.getElementById('profileAvatarLarge').style.cssText = avatarStyle;
            document.getElementById('profileAvatarLarge').textContent = data.profile.avatar ? '' : currentUser[0].toUpperCase();
            document.getElementById('profileUsername').textContent = currentUser;
            document.getElementById('profileBadges').innerHTML = (data.badges || []).map(renderBadge).join('');

            document.getElementById('displayName').textContent = data.profile.name || '-';
            document.getElementById('displayEmail').textContent = data.profile.email || '-';
            document.getElementById('displayPhone').textContent = data.profile.phone || '-';
            document.getElementById('displayBio').textContent = data.profile.bio || '-';

            document.getElementById('editName').value = data.profile.name || '';
            document.getElementById('editEmail').value = data.profile.email || '';
            document.getElementById('editPhone').value = data.profile.phone || '';
            document.getElementById('editBio').value = data.profile.bio || '';

            document.getElementById('adminTab').style.display = data.role === 'admin' ? 'block' : 'none';
        }

        async function handleProfileUpdate(e) {
            e.preventDefault();
            const formData = new FormData();
            if (document.getElementById('editAvatar').files[0]) formData.append('avatar', document.getElementById('editAvatar').files[0]);
            formData.append('name', document.getElementById('editName').value.trim());
            formData.append('email', document.getElementById('editEmail').value.trim());
            formData.append('phone', document.getElementById('editPhone').value.trim());
            formData.append('bio', document.getElementById('editBio').value.trim());

            const res = await fetch(API_URL + '/me', {
                method: 'PUT',
                headers: { 'Authorization': `Bearer ${localData.token}` },
                body: formData
            });

            if (res.ok) {
                const data = await res.json();
                userData = data;
                updateUI();
                showProfile();
                showToast('áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ');
            } else {
                showToast('áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ', 'error');
            }
        }

        async function assignBadge() {
            const username = document.getElementById('badgeUsername').value.trim();
            const badge = document.getElementById('badgeName').value.trim();
            if (!username || !badge) return showToast('áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜', 'error');

            const res = await api(`/admin/badge/${username}`, {
                method: 'POST',
                body: JSON.stringify({badge})
            });

            if (res && res.ok) showToast('áƒ‘áƒ”áƒ¯áƒ˜ áƒ›áƒ˜áƒœáƒ˜áƒ­áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ');
        }

        async function removeBadge() {
            const username = document.getElementById('removeBadgeUsername').value.trim();
            const badge = document.getElementById('removeBadgeName').value.trim();
            if (!username || !badge) return showToast('áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜', 'error');

            const res = await api(`/admin/badge/${username}`, {
                method: 'DELETE',
                body: JSON.stringify({badge})
            });

            if (res && res.ok) showToast('áƒ‘áƒ”áƒ¯áƒ˜ áƒ¬áƒáƒ¨áƒšáƒ˜áƒšáƒ˜áƒ');
        }

        function logout() {
            localStorage.removeItem(storageKey);
            localData = {token: null};
            currentUser = null;
            userData = null;
            document.getElementById('navActions').innerHTML = `<button class="btn btn-primary" onclick="showWelcomeModal()">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button><button class="btn btn-secondary" onclick="showWelcomeModal()">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</button>`;
            backToForum();
            showToast('áƒ’áƒáƒ›áƒáƒ¡áƒ•áƒšáƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜');
        }

        function backToForum() {
            document.getElementById('profileView').style.display = 'none';
            document.getElementById('sectionView').style.display = 'none';
            document.getElementById('threadView').style.display = 'none';
            document.getElementById('forumView').style.display = 'block';
            clearInterval(refreshInterval);
        }

        function backToForumFromSection() {
            document.getElementById('sectionView').style.display = 'none';
            document.getElementById('forumView').style.display = 'block';
            currentSection = null;
            clearInterval(refreshInterval);
        }

        function backToSectionFromThread() {
            document.getElementById('threadView').style.display = 'none';
            document.getElementById('sectionView').style.display = 'block';
            currentThread = null;
            renderThreads();
            clearInterval(refreshInterval);
            refreshInterval = setInterval(renderThreads, 30000);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function showLogin() { closeModal('welcomeModal'); document.getElementById('loginModal').classList.add('active'); }
        function showRegister() { closeModal('welcomeModal'); document.getElementById('registerModal').classList.add('active'); }

        function showNewThreadModal() {
            const section = document.querySelector(`.section[data-section="${currentSection}"]`);
            const isViewOnly = section?.dataset.viewOnly === 'true';
            if (isViewOnly && (!userData || userData.role !== 'admin')) {
                showToast('áƒáƒ› áƒ¡áƒ”áƒ¥áƒªáƒ˜áƒáƒ¨áƒ˜ áƒ›áƒ®áƒáƒšáƒáƒ“ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ áƒ¥áƒ›áƒœáƒ˜áƒ¡ áƒ—áƒ áƒ”áƒ“áƒ”áƒ‘áƒ¡', 'error');
                return;
            }
            document.getElementById('newThreadModal').classList.add('active');
        }

        let currentSlide = 0;
        function showSlide(n) {
            document.querySelectorAll('.carousel-slide').forEach((s,i) => s.classList.toggle('active', i===n));
            document.querySelectorAll('.carousel-dot').forEach((d,i) => d.classList.toggle('active', i===n));
            currentSlide = n;
        }
        function nextSlide() { showSlide((currentSlide + 1) % 2); }
        function prevSlide() { showSlide((currentSlide - 1 + 2) % 2); }
        function showWelcomeModal() { 
            document.getElementById('welcomeModal').classList.add('active'); 
            showSlide(0); 
        }

        async function viewUserProfile(username) {
            const res = await api(`/users/${username}`);
            if (!res || !res.ok) {
                showToast('áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ', 'error');
                return;
            }

            const data = await res.json();

            document.getElementById('forumView').style.display = 'none';
            document.getElementById('sectionView').style.display = 'none';
            document.getElementById('threadView').style.display = 'none';
            document.getElementById('profileView').style.display = 'block';

            document.getElementById('profileUsername').textContent = username;
            document.getElementById('profileBadges').innerHTML = (data.badges || []).map(renderBadge).join('');
            document.getElementById('displayName').textContent = data.profile.name || '-';
            document.getElementById('displayEmail').textContent = data.profile.email || '-';
            document.getElementById('displayPhone').textContent = data.profile.phone || '-';
            document.getElementById('displayBio').textContent = data.profile.bio || '-';

            const avatarStyle = data.profile.avatar ? `background-image:url(${data.profile.avatar});background-size:cover;background-position:center;` : 'background:linear-gradient(135deg,var(--primary),var(--secondary));';
            document.getElementById('profileAvatarLarge').style.cssText = avatarStyle;
            document.getElementById('profileAvatarLarge').textContent = data.profile.avatar ? '' : username[0].toUpperCase();

            const isOwn = username === currentUser;
            document.querySelector('.tab[onclick*="edit"]').style.display = isOwn ? 'block' : 'none';
            document.getElementById('editTab').style.display = isOwn ? 'block' : 'none';
            document.getElementById('adminTab').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await updateSectionStats();

            if (localData.token) {
                const res = await api('/me');
                if (res && res.ok) {
                    const data = await res.json();
                    currentUser = data.username;
                    userData = data;
                    updateUI();
                    updateSectionStats();
                } else {
                    localStorage.removeItem(storageKey);
                    localData.token = null;
                    showWelcomeModal();
                }
            } else {
                showWelcomeModal();
            }

            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('verifyForm').addEventListener('submit', handleVerify);
            document.getElementById('newThreadForm').addEventListener('submit', handleNewThread);
            document.getElementById('newReplyForm').addEventListener('submit', handleNewReply);
            document.getElementById('profileEditForm').addEventListener('submit', handleProfileUpdate);

            document.querySelectorAll('.section').forEach(el => {
                el.addEventListener('click', async () => {
                    currentSection = el.dataset.section;
                    document.getElementById('forumView').style.display = 'none';
                    document.getElementById('sectionView').style.display = 'block';
                    document.getElementById('sectionTitle').textContent = el.querySelector('.sec-title').textContent;
                    updateBreadcrumbs('section');
                    await renderThreads();

                    const newThreadBtn = document.querySelector('#sectionView .btn-primary');
                    const isViewOnly = el.dataset.viewOnly === 'true';
                    newThreadBtn.style.display = (isViewOnly && (!userData || userData.role !== 'admin')) ? 'none' : 'block';

                    clearInterval(refreshInterval);
                    refreshInterval = setInterval(renderThreads, 30000);
                });
            });

            window.onclick = e => { 
                if (e.target.classList.contains('modal') || e.target.classList.contains('fullscreen-modal')) {
                    e.target.classList.remove('active');
                }
            };
        });
    </script>
</body>
</html>
