<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>პროფილი • Zaratic Role Play</title>
    <link rel="icon" href="https://raw.githubusercontent.com/OGSunny/Testerweb/main/lv_0_20251120194047.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        :root{--bg:#0a0a10;--card:rgba(25,25,45,.96);--accent:#e91e63;--glow:#ff4081;--border:rgba(233,30,99,.3)}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Noto Sans Georgian',sans-serif;background:var(--bg);color:#fff;min-height:100vh}
        header{position:fixed;top:0;width:100%;background:rgba(15,15,35,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:15px 0;z-index:1000}
        .nav{max-width:1200px;margin:auto;display:flex;align-items:center;padding:0 25px}
        .back{color:#fff;text-decoration:none;display:flex;align-items:center;gap:10px;font-size:18px}
        .back:hover{color:var(--accent)}
        main{margin-top:100px;max-width:700px;margin:auto;padding:20px}
        .cover{height:180px;background:linear-gradient(135deg,var(--accent),#9c27b0);border-radius:20px 20px 0 0}
        .avatar{width:140px;height:140px;border-radius:50%;background:var(--accent);display:grid;place-items:center;font-size:56px;font-weight:bold;margin:-70px auto 20px;border:6px solid var(--bg);box-shadow:0 0 40px var(--glow)}
        h1{text-align:center;font-size:32px;margin-bottom:10px;color:var(--accent)}
        .role{text-align:center;padding:6px 16px;background:rgba(233,30,99,.2);border-radius:12px;display:inline-block;font-size:14px}
        .bio{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin:25px 0;line-height:1.7;min-height:100px;cursor:pointer}
        .edit-bio textarea{width:100%;min-height:120px;background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:12px;padding:15px;color:#fff;margin:10px 0}
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:30px 0}
        .stat{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;text-align:center}
        .stat-label{color:var(--accent);font-size:14px;margin-bottom:8px}
        .stat-value{font-size:24px;font-weight:700}
        .activity{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:25px}
        .activity h2{color:var(--accent);margin-bottom:20px}
        .act-item{padding:12px 0;border-bottom:1px solid rgba(255,255,255,.05);font-size:14px}
        .act-item:last-child{border:none}
        button{margin-top:25px;width:100%;padding:14px;background:var(--accent);border:none;border-radius:12px;color:#fff;font-size:16px;cursor:pointer}
        button:hover{background:var(--glow)}
    </style>
</head>
<body>
    <header><div class="nav"><a href="forum.html" class="back"><i class="fas fa-arrow-left"></i> უკან</a></div></header>
    <main>
        <div class="cover"></div>
        <div class="avatar" id="avatar">Z</div>
        <h1 id="username"></h1>
        <div class="role" id="role">მოთამაშე</div>
        <div class="bio" id="bio" onclick="editBio()">ბიო არ არის</div>
        <div class="edit-bio" id="editBio" style="display:none">
            <textarea id="bioText"></textarea>
            <button onclick="saveBio()">შენახვა</button>
        </div>
        <div class="stats">
            <div class="stat"><div class="stat-label">პოსტები</div><div class="stat-value" id="posts">0</div></div>
            <div class="stat"><div class="stat-label">რეგისტრაცია</div><div class="stat-value" id="reg"></div></div>
            <div class="stat"><div class="stat-label">ბოლო აქტივობა</div><div class="stat-value" id="last"></div></div>
        </div>
        <div class="activity">
            <h2>ბოლო აქტივობა</h2>
            <div id="activity"></div>
        </div>
        <button onclick="localStorage.clear();location='login.html'">გამოსვლა</button>
    </main>

    <script>
        const worker='https://data.jemalagegidze.workers.dev';
        const current=localStorage.username;
        if(!current) location='login.html';
        const url=new URL(location.href);
        const target=url.searchParams.get('username')||current;

        function color(n){let h=0;for(let i=0;i<n.length;i++)h=n.charCodeAt(i)+((h<<5)-h);const c=['#e91e63','#9c27b0','#673ab7','#3f51b5','#2196f3','#00bcd4','#009688','#4caf50','#ff9800','#ff5722'];return c[Math.abs(h)%c.length]}

        async function load(){
            const data=await fetch(`${worker}/user?username=${target}`).then(r=>r.json());
            document.getElementById('username').textContent=data.username;
            document.getElementById('avatar').textContent=data.username[0].toUpperCase();
            document.getElementById('avatar').style.background=color(data.username);
            document.getElementById('role').textContent=data.isAdmin?'ადმინისტრატორი':'მოთამაშე';
            document.getElementById('bio').textContent=data.bio||'ბიო არ არის';
            document.getElementById('posts').textContent=data.postCount;
            document.getElementById('reg').textContent=new Date(data.createdAt).toLocaleDateString('ka-GE');
            document.getElementById('last').textContent=new Date(data.lastOnline).toLocaleDateString('ka-GE',{hour:'2-digit',minute:'2-digit'});
        }

        window.editBio=()=>{if(target!==current) return;document.getElementById('bioText').value=document.getElementById('bio').textContent;document.getElementById('editBio').style.display='block';document.getElementById('bio').style.display='none';}
        window.saveBio=async()=>{const b=document.getElementById('bioText').value.trim();await fetch(worker+'/user/update',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:current,bio:b})});document.getElementById('bio').textContent=b||'ბიო არ არის';document.getElementById('editBio').style.display='none';document.getElementById('bio').style.display='block';}

        load();
    </script>
</body>
</html>
